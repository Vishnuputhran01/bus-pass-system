<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudBus Pro - Premium Bus Pass System</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #10b981;
            --accent: #f59e0b;
            --dark: #1e293b;
            --light: #f8fafc;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --shadow: 0 10px 25px rgba(0,0,0,0.1);
            --radius: 12px;
            --transition: all 0.3s ease;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            line-height: 1.6;
            color: var(--dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Page Styles */
        .page {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            border-radius: var(--radius) var(--radius) 0 0;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.1)"/></svg>');
            background-size: cover;
        }

        .header-content {
            position: relative;
            z-index: 2;
        }

        .logo {
            font-size: 2.5rem;
            margin-bottom: 1rem;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            font-weight: 300;
        }

        .cloud-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 50px;
            margin-top: 1rem;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.3);
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 2rem;
        }

        .auth-card {
            max-width: 450px;
            margin: 2rem auto;
        }

        /* Form Styles */
        .form-container {
            padding: 2rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--gray-light);
            border-radius: 8px;
            font-size: 16px;
            transition: var(--transition);
            background: white;
        }

        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Button Styles */
        .btn {
            background: var(--primary);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            width: 100%;
            justify-content: center;
        }

        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(37, 99, 235, 0.3);
        }

        .btn-secondary {
            background: var(--secondary);
        }

        .btn-secondary:hover {
            background: #0da271;
            box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-outline:hover {
            background: var(--primary);
            color: white;
        }

        .button-group {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        /* Navigation */
        .nav-links {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .nav-link {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            transition: var(--transition);
            background: rgba(255,255,255,0.1);
        }

        .nav-link:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        /* Demo Credentials */
        .demo-credentials {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .demo-credentials h4 {
            color: #92400e;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .credential-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
            padding: 0.25rem 0;
        }

        .credential-item:not(:last-child) {
            border-bottom: 1px dashed #f59e0b;
        }

        /* Search Form */
        .search-form {
            background: var(--light);
            padding: 2rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
        }

        .search-grid {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 1rem;
            align-items: end;
        }

        /* Routes Grid */
        .routes-grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .route-card {
            background: white;
            border: 1px solid var(--gray-light);
            border-radius: var(--radius);
            padding: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1rem;
        }

        .route-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .route-card.selected {
            border-color: var(--success);
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        }

        .route-info {
            flex: 1;
        }

        .route-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .route-name {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .route-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--success);
        }

        .route-details {
            display: grid;
            grid-template-columns: auto auto auto;
            gap: 1rem;
            color: var(--gray);
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Booking Form */
        .booking-form {
            background: var(--light);
            padding: 2rem;
            border-radius: var(--radius);
            margin-bottom: 2rem;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
        }

        /* Ticket Styles */
        .ticket {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            padding: 2rem;
            border-radius: var(--radius);
            border: 2px dashed #333;
            margin-top: 2rem;
            position: relative;
            overflow: hidden;
        }

        .ticket::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0,0 L100,0 L100,100 Z" fill="rgba(255,255,255,0.3)"/></svg>');
        }

        .ticket-content {
            position: relative;
            z-index: 2;
        }

        .ticket-header {
            text-align: center;
            margin-bottom: 1.5rem;
            border-bottom: 2px dashed #333;
            padding-bottom: 1rem;
        }

        .ticket-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .ticket-item {
            margin-bottom: 0.5rem;
        }

        .ticket-item strong {
            color: var(--dark);
        }

        /* Status Messages */
        .message {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            display: none;
        }

        .message.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .message.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .message.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #bfdbfe;
        }

        .message.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fde68a;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            display: none;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Features Grid */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .feature-card {
            background: var(--light);
            padding: 1.5rem;
            border-radius: var(--radius);
            text-align: center;
            transition: var(--transition);
        }

        .feature-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow);
        }

        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }

        /* Homepage Styles */
        .hero {
            text-align: center;
            padding: 4rem 2rem;
            color: white;
        }

        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 1rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        .hero-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .hero-btn {
            padding: 15px 30px;
            font-size: 1.1rem;
            width: auto;
        }

        /* Quick Login Buttons */
        .quick-login {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .quick-btn {
            flex: 1;
            padding: 8px 12px;
            font-size: 0.8rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
        }

        .quick-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .search-grid {
                grid-template-columns: 1fr;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .route-details {
                grid-template-columns: 1fr;
            }

            .ticket-details {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .header h1 {
                font-size: 2rem;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .nav-links {
                flex-direction: column;
                align-items: center;
            }

            .quick-login {
                flex-direction: column;
            }
        }

        /* Utility Classes */
        .text-center { text-align: center; }
        .text-success { color: var(--success); }
        .text-warning { color: var(--warning); }
        .text-error { color: var(--error); }
        .mb-1 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 2rem; }
        .mt-1 { margin-top: 1rem; }
        .mt-2 { margin-top: 2rem; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <!-- Home Page -->
    <div id="home-page" class="page active">
        <div class="container">
            <div class="hero">
                <div class="logo">
                    <i class="fas fa-bus"></i>
                </div>
                <h1>CloudBus Pro</h1>
                <p class="subtitle">Premium Cloud-Based Bus Pass System</p>
                <div class="cloud-badge">
                    <i class="fas fa-cloud"></i>
                    Powered by Supabase & Render
                </div>
                
                <div class="hero-buttons">
                    <button class="btn hero-btn" onclick="showPage('register-page')">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                    <button class="btn btn-secondary hero-btn" onclick="showPage('login-page')">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </div>

                <!-- Demo Notice -->
                <div class="demo-credentials" style="max-width: 500px; margin: 2rem auto;">
                    <h4><i class="fas fa-key"></i> Demo Login Credentials</h4>
                    <p style="margin-bottom: 0.5rem; color: #92400e;">Use these credentials for quick testing:</p>
                    <div class="credential-item">
                        <strong>Email:</strong> <span>demo@cloudbus.com</span>
                    </div>
                    <div class="credential-item">
                        <strong>Password:</strong> <span>demopass123</span>
                    </div>
                    <div class="credential-item">
                        <strong>Or click:</strong> 
                        <button class="quick-btn" onclick="quickLogin('demo@cloudbus.com', 'demopass123')">
                            Quick Login
                        </button>
                    </div>
                </div>
            </div>

            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h3>Secure & Reliable</h3>
                    <p>Bank-level security with cloud infrastructure</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-bolt"></i>
                    </div>
                    <h3>Instant Booking</h3>
                    <p>Real-time booking confirmation</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-mobile-alt"></i>
                    </div>
                    <h3>Mobile Friendly</h3>
                    <p>Works perfectly on all devices</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="fas fa-cloud"></i>
                    </div>
                    <h3>Cloud Powered</h3>
                    <p>Scalable cloud architecture</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Register Page -->
    <div id="register-page" class="page">
        <div class="container">
            <div class="card auth-card">
                <div class="header">
                    <div class="header-content">
                        <div class="logo">
                            <i class="fas fa-user-plus"></i>
                        </div>
                        <h1>Create Account</h1>
                        <p class="subtitle">Join CloudBus Pro today</p>
                    </div>
                </div>
                <div class="form-container">
                    <div class="demo-credentials">
                        <h4><i class="fas fa-info-circle"></i> Demo Available</h4>
                        <p>Already have demo credentials? <a href="javascript:void(0)" onclick="showPage('login-page')" style="color: #1e40af; text-decoration: underline;">Sign in here</a></p>
                    </div>
                    
                    <div class="form-group">
                        <label for="regName">Full Name</label>
                        <input type="text" id="regName" placeholder="Enter your full name">
                    </div>
                    <div class="form-group">
                        <label for="regEmail">Email Address</label>
                        <input type="email" id="regEmail" placeholder="Enter your email">
                    </div>
                    <div class="form-group">
                        <label for="regPhone">Phone Number</label>
                        <input type="tel" id="regPhone" placeholder="Enter your phone">
                    </div>
                    <div class="form-group">
                        <label for="regPassword">Password</label>
                        <input type="password" id="regPassword" placeholder="Create secure password">
                    </div>
                    <button class="btn" onclick="register()">
                        <i class="fas fa-user-plus"></i> Create Account
                    </button>
                    <div class="nav-links">
                        <a href="javascript:void(0)" onclick="showPage('home-page')" class="nav-link">
                            <i class="fas fa-home"></i> Home
                        </a>
                        <a href="javascript:void(0)" onclick="showPage('login-page')" class="nav-link">
                            <i class="fas fa-sign-in-alt"></i> Sign In
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="page">
        <div class="container">
            <div class="card auth-card">
                <div class="header">
                    <div class="header-content">
                        <div class="logo">
                            <i class="fas fa-sign-in-alt"></i>
                        </div>
                        <h1>Welcome Back</h1>
                        <p class="subtitle">Sign in to your account</p>
                    </div>
                </div>
                <div class="form-container">
                    <!-- Demo Credentials -->
                    <div class="demo-credentials">
                        <h4><i class="fas fa-key"></i> Demo Credentials</h4>
                        <div class="credential-item">
                            <strong>Email:</strong> <span>demo@cloudbus.com</span>
                        </div>
                        <div class="credential-item">
                            <strong>Password:</strong> <span>demopass123</span>
                        </div>
                        <div class="quick-login">
                            <button class="quick-btn" onclick="quickLogin('demo@cloudbus.com', 'demopass123')">
                                <i class="fas fa-bolt"></i> Quick Login as Demo User
                            </button>
                            <button class="quick-btn" onclick="quickLogin('admin@cloudbus.com', 'admin123')">
                                <i class="fas fa-user-shield"></i> Quick Login as Admin
                            </button>
                            <button class="quick-btn" onclick="quickLogin('test@user.com', 'testpass123')">
                                <i class="fas fa-user"></i> Quick Login as Test User
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="loginEmail">Email Address</label>
                        <input type="email" id="loginEmail" placeholder="Enter your email" value="demo@cloudbus.com">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Enter your password" value="demopass123">
                    </div>
                    <button class="btn btn-secondary" onclick="login()">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                    <div class="nav-links">
                        <a href="javascript:void(0)" onclick="showPage('home-page')" class="nav-link">
                            <i class="fas fa-home"></i> Home
                        </a>
                        <a href="javascript:void(0)" onclick="showPage('register-page')" class="nav-link">
                            <i class="fas fa-user-plus"></i> Create Account
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard Page -->
    <div id="dashboard-page" class="page">
        <div class="container">
            <div class="card">
                <div class="header">
                    <div class="header-content">
                        <div class="logo">
                            <i class="fas fa-tachometer-alt"></i>
                        </div>
                        <h1>Booking Dashboard</h1>
                        <p class="subtitle">Welcome, <span id="userName">User</span>!</p>
                        <div class="nav-links">
                            <a href="javascript:void(0)" onclick="showPage('home-page')" class="nav-link">
                                <i class="fas fa-home"></i> Home
                            </a>
                            <a href="javascript:void(0)" onclick="logout()" class="nav-link">
                                <i class="fas fa-sign-out-alt"></i> Logout
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Messages -->
            <div class="message success" id="successMsg"></div>
            <div class="message error" id="errorMsg"></div>
            <div class="message info" id="infoMsg"></div>

            <!-- Loading -->
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Processing your request...</p>
            </div>

            <div class="card">
                <div class="search-form">
                    <h3><i class="fas fa-search"></i> Find Your Route</h3>
                    <div class="search-grid">
                        <div class="form-group">
                            <label for="fromCity">From City</label>
                            <select id="fromCity">
                                <option value="">Select departure city</option>
                                <option value="New York">New York</option>
                                <option value="Boston">Boston</option>
                                <option value="Washington DC">Washington DC</option>
                                <option value="Chicago">Chicago</option>
                                <option value="Detroit">Detroit</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="toCity">To City</label>
                            <select id="toCity">
                                <option value="">Select destination city</option>
                                <option value="New York">New York</option>
                                <option value="Boston">Boston</option>
                                <option value="Washington DC">Washington DC</option>
                                <option value="Chicago">Chicago</option>
                                <option value="Detroit">Detroit</option>
                            </select>
                        </div>
                        <button class="btn" onclick="searchRoutes()">
                            <i class="fas fa-search"></i> Search Routes
                        </button>
                    </div>
                </div>
            </div>

            <!-- Available Routes -->
            <div class="routes-grid" id="routesGrid"></div>

            <!-- Booking Form -->
            <div class="card booking-form" id="bookingForm">
                <h3><i class="fas fa-user"></i> Passenger Details</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="passengerName">Full Name</label>
                        <input type="text" id="passengerName" placeholder="Enter passenger name">
                    </div>
                    <div class="form-group">
                        <label for="passengerAge">Age</label>
                        <input type="number" id="passengerAge" placeholder="Enter age" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label for="passengerGender">Gender</label>
                        <select id="passengerGender">
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-secondary" onclick="confirmBooking()">
                    <i class="fas fa-check-circle"></i> Confirm Booking
                </button>
            </div>

            <!-- Generated Ticket -->
            <div class="card ticket" id="ticket">
                <div class="ticket-content">
                    <div class="ticket-header">
                        <h2><i class="fas fa-ticket-alt"></i> E-TICKET</h2>
                        <p class="text-success">Booking Confirmed!</p>
                    </div>
                    <div class="ticket-details" id="ticketDetails"></div>
                    <div class="button-group mt-2">
                        <button class="btn" onclick="printTicket()">
                            <i class="fas fa-print"></i> Print Ticket
                        </button>
                        <button class="btn btn-outline" onclick="newBooking()">
                            <i class="fas fa-plus"></i> New Booking
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration - UPDATE THESE WITH YOUR CREDENTIALS
        const supabaseUrl = 'https://ocenrkcdjhovdspgcs.supabase.co'; // Your Supabase URL
        const supabaseKey = 'your-anon-public-key-here'; // Your anon public key
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        let currentUser = null;
        let selectedRoute = null;

        // Demo Users Database (for testing without Supabase)
        const demoUsers = [
            {
                id: 'demo-user-001',
                email: 'demo@cloudbus.com',
                password: 'demopass123',
                full_name: 'Demo User',
                phone: '+1-555-0101'
            },
            {
                id: 'admin-user-001',
                email: 'admin@cloudbus.com',
                password: 'admin123',
                full_name: 'Admin User',
                phone: '+1-555-0102'
            },
            {
                id: 'test-user-001',
                email: 'test@user.com',
                password: 'testpass123',
                full_name: 'Test User',
                phone: '+1-555-0103'
            }
        ];

        // Page Navigation
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.add('active');
            
            // Scroll to top
            window.scrollTo(0, 0);
        }

        // Utility Functions
        function showMessage(type, message) {
            const msgDiv = document.getElementById(type + 'Msg');
            msgDiv.innerHTML = message;
            msgDiv.style.display = 'block';
            setTimeout(() => msgDiv.style.display = 'none', 5000);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // Quick Login Function
        function quickLogin(email, password) {
            document.getElementById('loginEmail').value = email;
            document.getElementById('loginPassword').value = password;
            login();
        }

        // Authentication Functions
        async function register() {
            const name = document.getElementById('regName').value;
            const email = document.getElementById('regEmail').value;
            const phone = document.getElementById('regPhone').value;
            const password = document.getElementById('regPassword').value;

            if (!name || !email || !password) {
                showMessage('error', 'Please fill all required fields');
                return;
            }

            showLoading(true);
            try {
                // Try to register with Supabase first
                const { data, error } = await supabase
                    .from('users')
                    .insert([{ 
                        email: email, 
                        password: password,
                        full_name: name, 
                        phone: phone 
                    }])
                    .select();

                if (error) {
                    // If Supabase fails, use demo system
                    const existingUser = demoUsers.find(user => user.email === email);
                    if (existingUser) {
                        throw new Error('User already exists with this email');
                    }
                    
                    // Create new demo user
                    const newUser = {
                        id: 'user-' + Date.now(),
                        email: email,
                        password: password,
                        full_name: name,
                        phone: phone
                    };
                    demoUsers.push(newUser);
                    
                    showMessage('success', 'üéâ Registration successful! Using demo mode.');
                    currentUser = newUser;
                } else {
                    showMessage('success', 'üéâ Registration successful!');
                    currentUser = data[0];
                }
                
                // Clear form and redirect to dashboard
                document.getElementById('regName').value = '';
                document.getElementById('regEmail').value = '';
                document.getElementById('regPhone').value = '';
                document.getElementById('regPassword').value = '';
                
                document.getElementById('userName').textContent = currentUser.full_name;
                showPage('dashboard-page');
                
            } catch (error) {
                showMessage('error', '‚ùå Registration failed: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        async function login() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showMessage('error', 'Please enter email and password');
                return;
            }

            showLoading(true);
            try {
                // Try Supabase login first
                const { data, error } = await supabase
                    .from('users')
                    .select()
                    .eq('email', email)
                    .eq('password', password)
                    .single();

                if (error) {
                    // If Supabase fails, check demo users
                    const user = demoUsers.find(u => u.email === email && u.password === password);
                    if (user) {
                        currentUser = user;
                        showMessage('success', '‚úÖ Welcome back, ' + user.full_name + '! (Demo Mode)');
                    } else {
                        throw new Error('Invalid email or password');
                    }
                } else {
                    currentUser = data;
                    showMessage('success', '‚úÖ Welcome back, ' + data.full_name + '!');
                }
                
                document.getElementById('userName').textContent = currentUser.full_name;
                showPage('dashboard-page');
                
            } catch (error) {
                showMessage('error', '‚ùå Login failed: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function logout() {
            currentUser = null;
            showPage('home-page');
            showMessage('info', 'You have been logged out successfully.');
        }

        // Route and Booking Functions
        async function searchRoutes() {
            const fromCity = document.getElementById('fromCity').value;
            const toCity = document.getElementById('toCity').value;

            if (!fromCity || !toCity) {
                showMessage('error', 'Please select both departure and destination cities');
                return;
            }

            showLoading(true);
            try {
                const { data: routes, error } = await supabase
                    .from('bus_routes')
                    .select('*')
                    .eq('from_city', fromCity)
                    .eq('to_city', toCity)
                    .eq('is_active', true);

                if (error) throw error;
                
                displayRoutes(routes);
            } catch (error) {
                showMessage('error', 'Failed to fetch routes: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayRoutes(routes) {
            const routesGrid = document.getElementById('routesGrid');
            
            if (!routes || routes.length === 0) {
                routesGrid.innerHTML = '<div class="message warning">No routes found for the selected cities</div>';
                return;
            }

            routesGrid.innerHTML = routes.map(route => `
                <div class="route-card" onclick="selectRoute('${route.id}')" id="route-${route.id}">
                    <div class="route-info">
                        <div class="route-header">
                            <span class="route-name">${route.route_name}</span>
                            <span class="route-price">$${route.price}</span>
                        </div>
                        <div class="route-details">
                            <div class="detail-item">
                                <i class="fas fa-map-marker-alt"></i>
                                <span>${route.from_city} ‚Üí ${route.to_city}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-clock"></i>
                                <span>${route.departure_time} - ${route.arrival_time}</span>
                            </div>
                            <div class="detail-item">
                                <i class="fas fa-chair"></i>
                                <span>${route.seats_available} seats available</span>
                            </div>
                        </div>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            `).join('');
        }

        function selectRoute(routeId) {
            // Remove previous selection
            document.querySelectorAll('.route-card').forEach(card => {
                card.classList.remove('selected');
            });

            // Add selection to clicked card
            const selectedCard = document.getElementById(`route-${routeId}`);
            selectedCard.classList.add('selected');
            selectedRoute = routeId;

            // Show booking form
            document.getElementById('bookingForm').style.display = 'block';
            showMessage('info', 'Route selected! Please fill passenger details.');
        }

        async function confirmBooking() {
            const passengerName = document.getElementById('passengerName').value;
            const passengerAge = document.getElementById('passengerAge').value;
            const passengerGender = document.getElementById('passengerGender').value;

            if (!passengerName || !passengerAge || !selectedRoute) {
                showMessage('error', 'Please fill all passenger details and select a route');
                return;
            }

            showLoading(true);
            try {
                // Get route details
                const { data: routeData, error: routeError } = await supabase
                    .from('bus_routes')
                    .select('*')
                    .eq('id', selectedRoute)
                    .single();

                if (routeError) throw routeError;

                // Create booking
                const { data: bookingData, error: bookingError } = await supabase
                    .from('bookings')
                    .insert([{
                        user_id: currentUser.id,
                        route_id: selectedRoute,
                        passenger_name: passengerName,
                        passenger_age: parseInt(passengerAge),
                        passenger_gender: passengerGender,
                        total_price: routeData.price,
                        status: 'confirmed'
                    }])
                    .select();

                if (bookingError) throw bookingError;

                // Update seat count
                await supabase.rpc('decrease_seat_count', { route_id: selectedRoute });

                showMessage('success', '‚úÖ Booking confirmed successfully!');
                displayTicket(bookingData[0], routeData);
                document.getElementById('bookingForm').style.display = 'none';
                
            } catch (error) {
                showMessage('error', '‚ùå Booking failed: ' + error.message);
            } finally {
                showLoading(false);
            }
        }

        function displayTicket(booking, route) {
            const ticketDiv = document.getElementById('ticket');
            const ticketDetails = document.getElementById('ticketDetails');
            
            ticketDetails.innerHTML = `
                <div>
                    <div class="ticket-item"><strong>Ticket ID:</strong> ${booking.id.slice(0, 8)}</div>
                    <div class="ticket-item"><strong>Passenger:</strong> ${booking.passenger_name}</div>
                    <div class="ticket-item"><strong>Age:</strong> ${booking.passenger_age}</div>
                    <div class="ticket-item"><strong>Gender:</strong> ${booking.passenger_gender}</div>
                </div>
                <div>
                    <div class="ticket-item"><strong>Route:</strong> ${route.route_name}</div>
                    <div class="ticket-item"><strong>From:</strong> ${route.from_city}</div>
                    <div class="ticket-item"><strong>To:</strong> ${route.to_city}</div>
                    <div class="ticket-item"><strong>Departure:</strong> ${route.departure_time}</div>
                    <div class="ticket-item"><strong>Price:</strong> $${booking.total_price}</div>
                    <div class="ticket-item"><strong>Booking Date:</strong> ${new Date(booking.booking_date).toLocaleString()}</div>
                </div>
            `;
            
            ticketDiv.style.display = 'block';
        }

        function printTicket() {
            window.print();
        }

        function newBooking() {
            document.getElementById('ticket').style.display = 'none';
            document.getElementById('bookingForm').style.display = 'none';
            document.querySelectorAll('.route-card').forEach(card => {
                card.classList.remove('selected');
            });
            selectedRoute = null;
            
            // Clear form fields
            document.getElementById('passengerName').value = '';
            document.getElementById('passengerAge').value = '';
            document.getElementById('passengerGender').value = 'Male';
            
            showMessage('info', 'Ready for new booking!');
        }

        // Initialize the app
        window.addEventListener('load', () => {
            showMessage('info', 'üöÄ Welcome to CloudBus Pro! Use demo credentials for quick testing.');
            
            // Auto-fill demo credentials for easy testing
            document.getElementById('loginEmail').value = 'demo@cloudbus.com';
            document.getElementById('loginPassword').value = 'demopass123';
        });
    </script>
</body>
</html>